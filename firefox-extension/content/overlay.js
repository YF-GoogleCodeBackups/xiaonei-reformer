function loader(obj,direct) {
	if(direct) {
		var docWindow=obj
	} else {
		var docWindow=obj.target.defaultView.window;
		if(docWindow==docWindow.parent) {
			return;
		}
	}
	if(!docWindow.location.href.match("https?://.*\\.renren\\.com|https?://renren\\.com")) {
		return;
	}

(function(_window){var window=_window;var document=_window.document;if(window.self!=window.top){if(document.designMode=="on"){return}else{if(document.body&&!document.body.id&&!document.body.className){return}}}var XNR={};XNR.version="3.0.0.20100529";XNR.miniver=300;XNR.storage={};XNR.userId=$cookie("id","0");XNR.debug=false;XNR.options={};const UNKNOWN=0,USERSCRIPT=1,FIREFOX=2,CHROME=4;XNR.agent=UNKNOWN;if(window.chrome){XNR.agent=CHROME}else{if(typeof GM_setValue=="function"){XNR.agent=USERSCRIPT}else{if(typeof Components=="object"){XNR.agent=FIREFOX}}}var $=PageKit;function removeAds(evt){if(!evt){var ads=".ad-bar, .banner, .adimgr, .blank-bar, .renrenAdPanel, .side-item.template, .rrdesk, .video:not([style]), #sd_ad, #showAD, #huge-ad, #rrtvcSearchTip, #top-ads, #bottom-ads, #main-ads, #n-cAD, #webpager-ad-panel";$ban(ads);$wait(1,function(){$(".blank-holder").remove(true)})}$wait(1,function(){$("ul#feedHome > li").filter("a[href^='http://edm.renren.com/link.do?']").remove();$("ul#feedHome > li").filter("a[href^='http://im.renren.com/'][href*='.exe']").remove()})}function removePageTheme(){const themes=["head link[rel='stylesheet'][href*='/csspro/themes/'][href*='.css']","#hometpl_style","head link[rel='stylesheet'][href*='zidou_nav.css']","#domain_wrapper","#themeLink"];$(themes.join(",")).remove();$("head style").each(function(elem){var theme=$(elem);if(theme.text().contains("url(http://i.static.renren.com")){theme.remove();return true}});var logo=$("img[src*='viplogo-renren.png']").attr({height:null,width:null});if(logo.size()>0){logo.attr("src",logo.attr("src").replace("viplogo-renren.png","logo-renren.png"))}}function removeStarReminder(){const target="#tobestar, #realheadbulletin, #noStarNotice, #nostar, #home_nostar";$ban(target)}function removeMusicPlayer(){const target="#zidou_music, #ZDMusicPlayer, .mplayer, embed[src*='player.swf'] , embed[src*='Player.swf'], div.mod.music";$ban(target)}function removeFloatObject(){const target="#floatBox";$ban(target)}function removeMouseCursor(){$patchCSS("#opi{cursor:auto !important}")}function removeBlogTheme(){$("head style").each(function(elem){var s=$(elem);if(s.text().contains(".text-article")){s.remove();return true}})}function removeBlogLinks(){$("#blogContent a,#shareBody a").each(function(elem){var o=$(elem);if($page("blog",elem.href)){return}if($page("profile",elem.href)||o.text().match(/[\u0100-\uffff]{20,}/)){o.switchTo("span")}})}function removeBottomBar(){const target="#bottombar, #imengine";$ban(target)}function removeSysNotification(){const target="#system-notification-box";$ban(target)}function removeHomeGadgets(gadgetOpt){const gadgets={topNotice:".notice-holder, #notice_system",levelBar:".user-data",footprint:"#footPrint",newFriends:".side-item.pymk",sponsors:"#sponsorsWidget",publicPage:".side-item.commend-page",publicPageAdmin:"#pageAdmin",birthday:"#homeBirthdayPart",survey:".side-item.sales-poll",newStar:".star-new"};const filters={webFunction:{t:".side-item",f:".web-function"},};var patch="";for(var g in gadgets){if(!gadgetOpt[g]){continue}patch+=gadgets[g]+","}if(patch){$ban(patch.substring(0,patch.length-1))}$wait(1,function(){for(var g in filters){if(gadgetOpt[g]){$(filters[g].t).filter(filters[g].f).remove()}}})}function removeProfileGadgets(gadgetOpt){const gadgets={levelBar:"#userPoint.mod",album:"#album.mod",blog:"#blog.mod",share:"#share.mod",gift:"#gift.mod",fav:"#kuAi.mod",specialFriends:"#spFriends.mod",mutualFriends:"#cmFriends.mod",visitors:"#visitors.mod",friends:"#friends.mod",theme:".enter-paints,#paintother,#paintself"};var patch="";for(var g in gadgetOpt){if(!gadgetOpt[g]){continue}patch+=gadgets[g]+","}if(patch){$ban(patch.substring(0,patch.length-1))}}function hideRequest(req){const table={appRequest:"l-app",nodifyRequest:"l-request",pokeRequest:"l-poke",recommendRequest:"l-recommend",friendRequest:"l-friend",tagRequest:"l-tag",otherRequest:"iOther"};var box=$(".side-item.newrequests ul.icon");if(box.empty()){return}for(var r in req){if(req[r]&&table[r]){box.find("li img."+table[r]).superior().purge()}}}function rejectRequest(req){if(req.friendRequest){$get("http://www.renren.com/delallguestrequest.do?id="+XNR.userId)}if(req.pokeRequest){$get("http://www.renren.com/delallpoke.do")}if(req.appRequest==false&&req.tagRequest==false&&req.recommendRequest==false){return}$get("http://req.renren.com/request/requestList.do",function(html){if(html==null){return}if(req.appRequest){var command;while(command=/ignoreAllAppRequest\((\d+),(\d+),(\d+),'(.*?)'\)/g.exec(html)){$get("http://req.renren.com/request/ignoreAllAppRequest.do?post="+encodeURIComponent(JSON.stringify({type:command[1],id:command[2],appId:command[3],name:command[4]})))}while(command=/ignoreSpecialRequest\(101002,(\d+),(\d+),\d+,'.*?','.*?','.*?'\)/g.exec(html)){$get("http://app.renren.com/request/ignoreAppRequest.do?rid="+command[1]+"&appId="+command[2]+"&type=101002")}}if(req.tagRequest){var command;while(command=/refusePhotoRequest\((\d+),\d+,'.*?',\d+,\d+\)/g.exec(html)){$get("http://photo.renren.com/refuseptrequest.do?id="+command[1])}}if(req.recommendRequest){var command;while(command=/rejectRecommend\((\d+),'.*?',\d+\)/g.exec(html)){$get("http://friend.renren.com/RejectRecFriend.do?id="+command[1])}}})}function blockAppNotification(){$get("http://msg.renren.com/notify/notifications.do",function(html){var blocked=[];var command;while(command=/showDialog\(this,(\d+)\)/.exec(html)){if(!blocked[command[1]]){$get("http://msg.renren.com/notify/notifications.do?action=block&app_id="+command[1]);blocked[command[1]]=true}}})}function removeNavItems(navLinks){const links={theme:"i.renren.com/shop",app:"app.renren.com",game:"game.renren.com",vip:"i.renren.com/pay",vipCenter:"i.renren.com/index",pay:"pay.renren.com",invite:"invite.renren.com"};var style="";for(var l in navLinks){if(navLinks[l]){style+="div.nav-body .menu .menu-title a[href*='"+links[l]+"'],"}}if(style){style=style.substring(0,style.length-1);$patchCSS(style+"{display:none !important}");$wait(1,function(){style=style.replace(/div.nav-body .menu /g,"");$("div.nav-body .menu").filter(style).remove()})}}function widenNavBar(){$patchCSS(".navigation-wrapper,.navigation{width:auto} .navigation .nav-body{width:auto;float:none}")}function addNavItems(content){if(!content){return}var nav=$("div.nav-main");if(nav.empty()){return}var items=content.split("\n");for(var i=0;i<items.length;i+=2){$node("div").code('<div class="menu-title"><a href="'+items[i+1]+'" target="_blank">'+items[i]+"</a></div>").attr("class","menu").appendTo(nav)}location.href="javascript:(function(){try{var e=document.body.querySelectorAll('.nav-main .menu-title > a');for(var i in e){e[i]._ad_rd=true;}}catch(ex){}})();"}function recoverOriginalTheme(ignoreTheme){var FCOLOR="#3B5998";var XCOLOR="#3B5888";var BCOLOR="#5C75AA";var SCOLOR="#EBF3F7";var prepatch=$patchCSS("a,a:link,a:visited,a:hover{color:"+FCOLOR+"}.navigation .nav-body{background-color:"+XCOLOR+"}.user-data,.panel.bookmarks,.statuscmtitem,.new-user{background-color:"+SCOLOR+"}");$wait(1,function(){if(!ignoreTheme){var theme=false;if(!$("head > link[ref='stylesheet'][herf*='zidou_nav.css']").empty()){theme=true}else{if(!$("#themeLink:not([href*='sid=-1'])").empty()){theme=true}else{if(!$("#hometpl_style").empty()&&$("#hometpl_style").text().contains("{")){theme=true}else{$("head style").each(function(elem){if($(elem).text().contains("url(http://i.static.renren.com")){theme=true;return true}})}}}if(theme){prepatch.remove();return}}var css="";const files={"home-all.css":["a,a:link,a:visited,a:hover{color:"+FCOLOR+"}",".navigation .nav-body{background-color:"+XCOLOR+"}",".navigation .menu-title a:hover{background-color:"+BCOLOR+"}",".input-button, .input-submit{background-color:"+FCOLOR+"}",".pop_content .dialog_body a,.pop_content .dialog_body a:visited{color:"+FCOLOR+"}",".pop_content h2{background-color:"+XCOLOR+"}","ul.square_bullets{color:"+FCOLOR+"}",".menu-dropdown .menu-item li.show-more a:hover{background-color:"+FCOLOR+"}",".menu-dropdown .menu-item a:hover{background-color:"+FCOLOR+"}",".menu-dropdown .optionmenu li a:hover{background-color:"+FCOLOR+"}",".m-chat .chatnote a,.m-chat .chatnote em{color:"+FCOLOR+"}",".publisher .status-publisher input.submit{background-color:"+FCOLOR+"}","ul.richlist.feeds li .details a.share:hover{color:"+FCOLOR+"}",".app-box .common-app h1 .open{color:"+FCOLOR+"}",".user-data,.panel.bookmarks,.statuscmtitem{background-color:"+SCOLOR+"}",],"webpager-std-min.css":[".webpager ul.icon a:hover .tooltip{background-color:"+FCOLOR+"}",".app-list dl.apps dd a:hover span.del-handle:hover{background-color:"+FCOLOR+"}",],"layout.css":["a,a:link,a:visited,a:hover{color:"+FCOLOR+"}","a.share:hover,a.mini-share:hover,a.action:hover{background-color:"+FCOLOR+"}",".input-button,.input-submit{background-color:"+FCOLOR+"}","td.pop_content .dialog_buttons input{background-color:"+FCOLOR+" !important}","td.pop_content h2{background-color:"+XCOLOR+"}","ul.square_bullets{color:"+FCOLOR+"}",".navigation{background-color:"+XCOLOR+"}",".navigation .menu-title a:hover{background-color:"+BCOLOR+"}",".menu-dropdown .menu-item li.show-more a:hover{background-color:"+FCOLOR+"}",".menu-dropdown .menu-item a:hover{background-color:"+FCOLOR+"}",".menu-dropdown .optionmenu li a:hover{background-color:"+FCOLOR+"}","ol.pageclip li a:hover{background-color:"+FCOLOR+"}",".pagerpro li a:hover{background-color:"+FCOLOR+"}",".pagerpro li.current a, .pagerpro li.current a:hover{color:"+FCOLOR+"}","#pages-jump a{color:"+FCOLOR+"}","#pop-login h1{background-color:"+FCOLOR+"}",".newpop .share_popup .toggle_tabs li a{color:"+FCOLOR+"}",],"news-feeds.css":["ul.richlist.feeds li div.details a.share:hover{color:"+FCOLOR+"}",],"profilepro.css":[".imgbtn-1{background-color:"+FCOLOR+"}",],"profile-skin.css":[".tabs-holder .tabpanel a:visited,.tabs-holder .tabpanel a{color:"+FCOLOR+"}",".super-menu li a:hover{background-color:"+FCOLOR+"}",".filter li.c a{background-color:"+BCOLOR+"}",],"msg.css":[".page-titletabs a.add-msg{background-color:"+FCOLOR+"}",".inputbutton,.inputsubmit,.subbutton,.canbutton,.button-group button{background-color:"+FCOLOR+"}",".messages .next_message:hover,.messages .previous_message:hover{background-color:"+FCOLOR+"}",],"dialogpro.css":["ul.square_bullets{color:"+FCOLOR+"}","td.pop_content h2{background-color:"+XCOLOR+"}",],"page.css":[".page-tabs .tabpanel a,.page-tabs .tabpanel a:visited{color:"+FCOLOR+"}",".page-tabs .tabpanel li.select a,.page-tabs .tabpanel li.addtab a:hover{color:"+FCOLOR+"}",".stabs a,.stabs a:hover,.stabs a:visited{color:"+FCOLOR+"}","form.editDesc input{color:"+FCOLOR+"}",".theme-panel a,.theme-panel a:link,.theme-panel a:hover,.theme-panel a:visited{color:"+FCOLOR+"}",".thmc-action .del:hover{background-color:"+FCOLOR+"}","td.pop_content .dialog_body .ordertabs a.s{background-color:"+FCOLOR+" !important}",".info-item .photoes ul li .name{color:"+FCOLOR+"}",],"appspro.css":[".sub-nav ul.main li.son-nav a.pre-select,.sub-nav ul.main li.son-nav a:hover.pre-select,.sub-nav ul.main li.allselect a{background-color:"+FCOLOR+"}",".sub-nav li ul.sub li a{color:"+FCOLOR+"}",".sub-nav ul.main li a.select,.sub-nav li ul.sub li a.select,.sub-nav li ul.sub li a.select:hover{background-color:"+FCOLOR+"}",".sub-nav li ul.sub li a.select,.sub-nav li ul.sub li a.select:hover{background-color:"+FCOLOR+"}",".sub-nav,.user-data,.panel.bookmarks,.section h2,.tab-switch{background-color:"+SCOLOR+"}",],"albumpro.css":[".photo-comments #side-column ul.actions .rotate-left a:hover,.photo-comments #side-column ul.actions .rotate-right a:hover{background-color:"+FCOLOR+"}",".share a:hover{background-color:"+FCOLOR+"}","h3.upload-step-1 .pick-more{color:"+FCOLOR+"}",".pager-top a.current, .pager-top a.current:hover{color:"+FCOLOR+"}","a.act-btn{background-color:"+FCOLOR+"}",],"subscription.css":[".ss-menu li.cur a{background-color:"+XCOLOR+"}",".subs-search p .subbutton{background-color:"+FCOLOR+"}",".subs-commend li .detail .add a{background-color:"+FCOLOR+"}",],"replies.css":[".replies a.reply-report:hover{color:"+FCOLOR+"}",],"homepro.css":[".new-user{background-color:"+SCOLOR+"}",".home-nav .c a,.home-nav .c a:hover{background-color:"+FCOLOR+"}",],"login-all.css":["a,a:link,a:visited,a:hover{color:"+FCOLOR+"}","a.action:hover,a.share:hover,a.mini-share:hover{background-color:"+FCOLOR+"}",".input-button,.input-submit{background-color:"+FCOLOR+"}",".navigation{background-color:"+XCOLOR+"}",".navigation .menu-title a:hover{background-color:"+BCOLOR+"}",],"login-unbuffered.css":["a,a:link,a:visited,a:hover{color:"+FCOLOR+"}","a.action:hover,a.share:hover,a.mini-share:hover{background-color:"+FCOLOR+"}",".input-button,.input-submit{background-color:"+FCOLOR+"}",".navigation{background-color:"+XCOLOR+"}",".navigation .menu-title a:hover{background-color:"+BCOLOR+"}",],};var style="";for(var f in files){if(!$("head link[rel='stylesheet'][href*='"+f+"']").empty()){style+=files[f].join("")}}if(style){$patchCSS(style)}prepatch.remove()})}function recoverBigDeleteBtn(){$patchCSS('ul.richlist.feeds li a.delete{background:url("http://xnimg.cn/imgpro/home/home_icon.png") no-repeat scroll -115px 0 transparent;height:18px;width:18px}ul.richlist.feeds li a.delete:hover{background:url("http://xnimg.cn/imgpro/home/home_icon.png") no-repeat scroll -133px 0 transparent;height:18px;width:18px}')}function removeFontRestriction(){$patchCSS("*{font-family:none !important}")}function limitHeadList(amountString){var amount=parseInt(amountString);if(amount==0){return}$("ul.people-list").each(function(elem){var list=$(elem);while(list.heirs()>amount){list.child(amount).remove()}})}function moveMessageBoardToBottom(){$(".talk-box").append($(".talk-box>.box"))}function fixNavItemHeight(){$patchCSS(".navigation .menu-title a{max-height:35px}")}function fixClubContent(){$patchCSS(".content{overflow:visible}")}function diagnose(){var str="";str+="运行环境："+navigator.userAgent+"\n";str+="当前页面："+window.location.href+"\n";str+="程序版本："+XNR.version+"("+XNR.miniver+") - "+XNR.agent+"\n";str+="功能："+JSON.stringify(XNR.options)+"\n\n\n";$("div.xnr_op #diagnosisInfo").value(str)}function extendPrototype(){if(!String.prototype.contains){String.prototype.contains=function(str){return this.indexOf(str)!=-1}}if(!String.prototype.repeat){String.prototype.repeat=function(times){var a="";for(;times>0;times--){a+=this}return a}}if(!Date.prototype.format){Date.prototype.format=function(fmt){var o={"y+":this.getFullYear(),"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),};for(var i in o){if(new RegExp("("+i+")").test(fmt)){fmt=fmt.replace(RegExp.$1,"0".repeat(RegExp.$1.length-o[i].toString().length)+o[i])}}return fmt}}if(!Function.prototype.getName){Function.prototype.getName=function(){return/function (.*?)\(/.exec(this.toString())[1]}}}function main(savedOptions){extendPrototype();var optionMenu={"清理页面":[{text:"##清除各类广告",ctrl:[{id:"removeAds",value:true,fn:[{name:removeAds,stage:0,fire:true,trigger:{"ul#feedHome":"DOMNodeInserted"},}],}],},{text:"##去除页面主题模板",ctrl:[{id:"removePageTheme",value:false,fn:[{name:removePageTheme,stage:1,fire:true,}],}],},{text:"##去除升级星级用户提示",ctrl:[{id:"removeStarReminder",value:true,fn:[{name:removeStarReminder,stage:0,fire:true,}],}],},{text:"##去除音乐播放器",ctrl:[{id:"removeMusicPlayer",value:false,fn:[{name:removeMusicPlayer,stage:0,fire:true,}],}],},{text:"##去除页面飘浮物",ctrl:[{id:"removeFloatObject",value:false,fn:[{name:removeFloatObject,stage:0,fire:true,}],}],page:"profile",},{text:"##去除页面自定义鼠标指针",ctrl:[{id:"removeMouseCursor",value:false,fn:[{name:removeMouseCursor,stage:0,fire:true,}],}],page:"profile",},{text:"##去除日志信纸",ctrl:[{id:"removeBlogTheme",value:false,fn:[{name:removeBlogTheme,stage:1,fire:true,}],}],page:"blog",},{text:"##去除日志中整段链接",ctrl:[{id:"removeBlogLinks",value:false,fn:[{name:removeBlogLinks,stage:1,fire:true,}],}],page:"blog",},{text:"##去除底部工具栏",ctrl:[{id:"removeBottomBar",value:false,fn:[{name:removeBottomBar,stage:0,fire:true,}],}]},{text:"##去除右下角系统通知",ctrl:[{id:"removeSysNotification",value:false,fn:[{name:removeSysNotification,stage:0,fire:true,}]}]},{text:"##",ctrl:[{type:"hidden",fn:[{name:removeHomeGadgets,stage:0,args:["@homeGadgets"]}],}],page:"home"},{id:"homeGadgets",text:"去除首页上以下部件",column:2,ctrl:[{id:"topNotice",text:"##顶部通知栏",value:false,},{id:"levelBar",text:"##个人等级栏",value:false,},{id:"footprint",text:"##最近来访",value:false,},{id:"newFriends",text:"##好友推荐",value:false,},{id:"sponsors",text:"##赞助商内容",value:false,},{id:"publicPage",text:"##公共主页推荐",value:false,},{id:"publicPageAdmin",text:"##公共主页管理",value:false,},{id:"birthday",text:"##好友生日",value:false,},{id:"webFunction",text:"##站内功能",value:false,},{id:"survey",text:"##人人网调查",value:false,},{id:"newStar",text:"##人气之星/新人栏",value:false,}],},{text:"##",ctrl:[{type:"hidden",fn:[{name:removeProfileGadgets,stage:0,args:["@profileGadgets"]}],}],page:"profile"},{id:"profileGadgets",text:"去除个人主页上以下部件",column:2,ctrl:[{id:"levelBar",text:"##等级栏",value:false,},{id:"album",text:"##相册",value:false,},{id:"blog",text:"##日志",value:false,},{id:"share",text:"##分享",value:false,},{id:"gift",text:"##礼物",value:false,},{id:"fav",text:"##酷爱",value:false,},{id:"theme",text:"##装扮主页",value:false,},{id:"specialFriends",text:"##特别好友",value:false,},{id:"mutualFriends",text:"##共同好友",value:false,},{id:"visitors",text:"##最近来访",value:false,},{id:"friends",text:"##好友",value:false,}]}],"处理请求":[{text:"##",ctrl:[{type:"hidden",fn:[{name:hideRequest,stage:1,args:["@hideRequestGroup"]}],}],page:"home",},{id:"hideRequestGroup",text:"隐藏首页上以下类型的请求",column:3,ctrl:[{id:"appRequest",text:"##应用请求",value:false,},{id:"nodifyRequest",text:"##通知",value:false,},{id:"pokeRequest",text:"##招呼",value:false,},{id:"recommendRequest",text:"##好友推荐",value:false,},{id:"friendRequest",text:"##好友申请",value:false,},{id:"tagRequest",text:"##圈人",value:false,},{id:"otherRequest",text:"##其他请求",value:false,},],},{text:"##",login:true,ctrl:[{type:"hidden",fn:[{name:rejectRequest,stage:0,args:["@rejectRequestGroup"]}],}],},{id:"rejectRequestGroup",text:"自动拒绝以下类型的请求",info:"由于是在后台进行拒绝，首页上可能仍然会显示有请求待处理",column:3,ctrl:[{id:"appRequest",text:"##应用请求",value:false,},{id:"recommendRequest",text:"##好友推荐",value:false,},{id:"friendRequest",text:"##好友申请",value:false,},{id:"tagRequest",text:"##圈人",value:false,},{id:"pokeRequest",text:"##招呼",value:false,}],},{text:"##自动屏蔽应用通知##",login:true,ctrl:[{id:"blockAppNotification",value:false,fn:[{name:blockAppNotification,stage:0}],},{type:"info",value:"在“站内信”->“通知”处可以解除屏蔽",}],master:0}],"改造导航栏":[{text:"##",ctrl:[{type:"hidden",fn:[{name:removeNavItems,stage:0,args:["@navLinks"]}],}],},{id:"navLinks",text:"去除以下链接",column:3,ctrl:[{id:"theme",text:"##装扮",value:false},{id:"app",text:"##应用",value:false},{id:"game",text:"##游戏",value:false},{id:"vip",text:"##升级VIP",value:false},{id:"vipCenter",text:"##VIP中心",value:false},{id:"pay",text:"##充值",value:false},{id:"invite",text:"##邀请",value:false}]},{text:"##加宽导航栏",ctrl:[{id:"widenNavBar",value:false,fn:[{name:widenNavBar,stage:0,fire:true,}],}]},{text:"##增加导航栏项目##",ctrl:[{id:"addNavItems",value:false,fn:[{name:addNavItems,stage:2,args:["@navItemsContent"],fire:true}],},{id:"navItemsContent",type:"edit",style:"width:99%;height:80px;overflow:auto;word-wrap:normal;margin-top:5px",value:"论坛\nhttp://club.renren.com/"}],master:0}],"改造界面":[{text:"##使用深蓝色主题##",ctrl:[{id:"recoverOriginalTheme",value:false,fn:[{name:recoverOriginalTheme,stage:0,fire:true,args:["@removePageTheme"]}],},{type:"info",value:"使用早期的类Facebook配色。在有模板的页面不会修改其配色",}],master:0},{text:"##使用大号新鲜事删除按钮",ctrl:[{id:"recoverBigDeleteBtn",value:false,fn:[{name:recoverBigDeleteBtn,stage:0,fire:true,}],}],page:"home,profile"},{text:"##去除页面字体限制##",ctrl:[{id:"removeFontRestriction",value:false,fn:[{name:removeFontRestriction,stage:0,fire:true}]},{type:"info",value:"使用浏览器本身设定的字体而非网站限制使用的字体"}],master:0},{text:"##限制个人主页上头像列表中的头像数量最多为##个",ctrl:[{id:"limitHeadList",value:false,fn:[{name:limitHeadList,stage:1,fire:true,args:["@headsAmount"]}]},{id:"headsAmount",value:"12",type:"input",style:"width:30px;margin-left:3px;margin-right:3px",verify:{"^[0-9]{1,2}$":"请在头像最大数量处输入1～2位正整数"}}],master:0,page:"profile"},{text:"##将个人主页上留言板移至新鲜事下方",ctrl:[{id:"moveMessageBoardToBottom",value:false,fn:[{name:moveMessageBoardToBottom,stage:1,fire:true}]}],page:"profile"},{text:"##修正导航栏项目高度##",ctrl:[{id:"fixNavItemHeight",value:false,fn:[{name:fixNavItemHeight,stage:0,fire:true}]},{type:"info",value:"如果您将浏览器字体的最小大小设成大于12，可能会出现导航栏上的项目高度过大的错误。如果您遇到这个问题，请启用此功能。"}],master:0},{text:"##修正论坛帖子排版错误##",agent:FIREFOX|USERSCRIPT,ctrl:[{id:"fixClubContent",value:false,fn:[{name:fixClubContent,stage:0,fire:true}]},{type:"info",value:"如果您将浏览器字体的最小大小设成大于12，可能会出现论坛的帖子正文偏右的错误。如果您遇到这个问题，请启用此功能。",}],master:0,page:"club"}],"诊断信息":[{text:"##如果您遇到功能出错，请在报告问题时附带上出错页面中的以下信息：##",ctrl:[{type:"hidden",fn:[{name:diagnose,stage:1,}],},{id:"diagnosisInfo",type:"edit",style:"width:99%;height:230px;margin-top:5px",readonly:true,}],}]};const infoImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAuUlEQVQ4y2NgoDbQ9upiiK5eznD17sv/yDi2ajlYDi9wSZ+NoREdu2bNxa7ZJnkWXHPepH1YMUzeNnU6prPRNaMDdEOU3boRBoSWLWXApxmbIRHlyxAG4LIdFx+mHqcByBifNwgagE0zWQbgig24AWFogUgIgxNW7QpEIIKiBJsr8DlfxXMSalpwTpuJPyFN2ItIjXlzsKdGx9h2gknZLqYFf37gktJmCM2dhGFQaE4/A6eYKtUzLwMAfM0C2p5qSS4AAAAASUVORK5CYII%3D";const warnImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA1ElEQVQ4y2NgoCVYz8BgsJyBwYQszUCNsv8ZGP6D8FIGBlWSDYBphmGSNC9jYNAGabqUkvL/cmYm2IAlDAympNsOA6S4YjUDgxVI8dX8fLj+6+XlYAPWsbB4kGQ7hMtAvCvWsrN7gxRdq6jAMOBWSwvYgE1sbJFE+x3FBUiuaGBgYMKp+Xpz839c4P7UqWA1QJfmomgGmYgR8thcgOSKmQwMrBi23+js/E8IPJ47FyNAudBTHbEY7gJjBgbdDgaG7k4GhqmEcDcDw2Qg7ogA5hWq5FgAlMwfVWL5pDoAAAAASUVORK5CYII%3D";const showTooltip=function(evt){var tip=$alloc("optionsMenu_tooltip");var rect=evt.target.getBoundingClientRect();tip.w=$node("div").style({maxWidth:"300px",background:"#FFFFBF",border:"1px solid #CFCF3D",position:"fixed",zIndex:"200001",padding:"6px 8px 6px 8px",fontSize:"13px",left:(rect.right+3)+"px",top:(rect.bottom+3)+"px"});$node("span").text(evt.target.getAttribute("tooltip")).appendTo(tip.w);tip.w.appendTo(document.documentElement)};const hideTooltip=function(evt){$alloc("optionsMenu_tooltip").w.remove();$dealloc("optionsMenu_tooltip")};var fnQueue=[[],[],[],[]];var categoryHTML="";var categoryPages=[];for(var category in optionMenu){categoryHTML+="<li><span>"+category+"</span></li>";var page=$node("div");for(var iFunc=0;iFunc<optionMenu[category].length;iFunc++){var o=optionMenu[category][iFunc];if(o.agent&&(o.agent&XNR.agent)==0){continue}var noexec=false;if(o.page){var p=o.page.split(",");noexec=true;for(var iPage=0;iPage<p.length;iPage++){if($page(p[iPage])==true){noexec=false;break}}}if(o.login&&XNR.userId=="0"){noexec=true}var block=$node("div");if(!o.id){var text=o.text.split("##");for(var iText=0;iText<text.length;iText++){if(text[iText]){var masterID="";if(o.master==null&&o.ctrl.length==1){masterID=o.ctrl[0].id}else{if(o.master!=null){masterID=o.ctrl[o.master].id}}$node("label").attr("for",masterID).text(text[iText]).appendTo(block)}var control=o.ctrl[iText];if(!control){continue}if(control.id&&savedOptions[control.id]!=null&&!control.readonly){control.value=savedOptions[control.id]}var node=null;switch(control.type||"check"){case"check":node=$node("input").attr("type","checkbox");break;case"hidden":control.value=null;break;case"input":node=$node("input");break;case"edit":node=$node("textarea");break;case"button":node=$node("input").attr("type","button");break;case"label":node=$node("span");break;case"info":node=$node("input").attr({type:"image",src:infoImage,tooltip:control.value,tabIndex:-1});node.hook("mouseover",showTooltip).hook("mouseout",hideTooltip);control.value=null;break;case"warn":node=$node("input").attr({type:"image",src:warnImage,tooltip:control.value,tabIndex:-1});node.hook("mouseover",showTooltip).hook("mouseout",hideTooltip);control.value=null;break}if(node){if(control.value!=null){node.value(control.value)}if(control.id){node.attr("id",control.id)}if(control.style){node.attr("style",control.style)}if(control.readonly){node.attr("readonly","true");control.value=null}if(control.verify){node.attr("verify",JSON.stringify(control.verify))}node.appendTo(block)}if(control.value!=null){XNR.options[control.id]=control.value}if(!noexec&&control.fn){for(var iFn=0;iFn<control.fn.length;iFn++){var fn=control.fn[iFn];if(!fn.args){fn.args=[]}if(fn.fire==null||(typeof fn.fire=="boolean"&&node.value()==fn.fire)){fnQueue[fn.stage].push({name:fn.name,args:fn.args})}else{if(typeof fn.fire=="string"){node.hook(fn.fire,function(evt){try{fn.name(evt,fn.args[0],fn.args[1],fn.args[2],fn.args[3])}catch(err){$error(fn.name,err)}})}}if(fn.trigger){fnQueue[(fn.stage==0?1:fn.stage)].push({name:fn.name,args:fn.args,trigger:fn.trigger})}}}}}else{if(o.text){var node=$node("div").text(o.text).appendTo(block);if(o.info){$node("input").attr({type:"image",src:infoImage,tooltip:o.info,tabIndex:-1}).hook("mouseover",showTooltip).hook("mouseout",hideTooltip).appendTo(node)}if(o.warn){$node("input").attr({type:"image",src:warnImage,tooltip:o.info,tabIndex:-1}).hook("mouseover",showTooltip).hook("mouseout",hideTooltip).appendTo(node)}}var group={};var table=$node("tbody").appendTo($node("table").attr("class","group").appendTo(block));for(var i=0;i<o.ctrl.length;){var tr=$node("tr").appendTo(table);for(var j=0;j<o.column;j++,i++){var item=o.ctrl[i];var td=$node("td").appendTo(tr);if(i<o.ctrl.length){if(o.id&&savedOptions[o.id]!=null&&savedOptions[o.id][item.id]!=null){item.value=savedOptions[o.id][item.id]}var text=item.text.split("##");if(text[0]){$node("label").attr("for",o.id+"_"+item.id).text(text[0]).appendTo(td)}var node=null;switch(item.type||"check"){case"check":node=$node("input").attr("type","checkbox");break;case"hidden":item.value=null;break;case"input":node=$node("input");break;case"edit":node=$node("textarea");break;case"button":node=$node("input").attr("type","button");break;case"label":node=$node("span");break}if(node){node.value(item.value);node.attr({id:o.id+"_"+item.id,style:(item.style||"")});node.appendTo(td)}if(item.verify){node.attr("verify",JSON.stringify(control.verify))}if(item.value!=null){group[item.id]=item.value}if(text[1]){$node("label").attr("for",o.id+"_"+item.id).text(text[1]).appendTo(td)}}}}XNR.options[o.id]=group}if(o.master!=null){var target=block.find("*:not(label)").pick(o.master);target.attr("master","true");$master(target);target.hook("click,keyup",function(evt){$master($(evt.target))})}if(block.heirs()!=0){page.append(block)}}categoryPages.push(page.style("display","none").get())}for(var iStage=0;iStage<4;iStage++){for(var i=0;i<fnQueue[iStage].length;i++){var fn=fnQueue[iStage][i];if(!fn.args){continue}for(var iArg=0;iArg<4;iArg++){if(typeof fn.args[iArg]=="string"&&fn.args[iArg].charAt(0)=="@"){fn.args[iArg]=XNR.options[fn.args[iArg].substring(1)]}}}}for(var i=0;i<fnQueue[0].length;i++){var fn=fnQueue[0][i];try{fn.name(fn.args[0],fn.args[1],fn.args[2],fn.args[3])}catch(err){$error(fn.name,err)}}var menuHTML='<style type="text/css">.xnr_op{width:500px;position:fixed;z-index:200000;color:black;blackground:black;font-size:12px}.xnr_op *{padding:0;margin:0;border-collapse:collapse}.xnr_op a{color:#3B5990}.xnr_op table{width:100%;table-layout:fixed}.xnr_op .tl{border-top-left-radius:8px;-moz-border-radius-topleft:8px}.xnr_op .tr{border-top-right-radius:8px;-moz-border-radius-topright:8px}.xnr_op .bl{border-bottom-left-radius:8px;-moz-border-radius-bottomleft:8px}.xnr_op .br{border-bottom-right-radius:8px;-moz-border-radius-bottomright:8px}.xnr_op .border{height:10px;overflow:hidden;width:10px;background-color:black;opacity:0.5}.xnr_op .m{width:100%}.xnr_op .title {padding:4px;display:block;background:#3B5998;color:white;text-align:center;font-size:12px;-moz-user-select:none;-khtml-user-select:none;cursor:default}.xnr_op .btns{background:#F0F5F8;text-align:right}.xnr_op .btns>input{border-style:solid;border-width:1px;padding:2px 15px;margin:3px;font-size:13px}.xnr_op .ok{background:#5C75AA;color:white;border-color:#B8D4E8 #124680 #124680 #B8D4E8}.xnr_op .cancel{background:#F0F0F0;border-color:#FFFFFF #848484 #848484 #FFFFFF}.xnr_op>table table{background:#FFFFF4}.xnr_op .options>table{height:280px;border-spacing:0}.xnr_op .c td{vertical-align:top}.xnr_op .category{width:119px;min-width:119px;border-right:1px solid #5C75AA}.xnr_op li{list-style-type:none}.xnr_op .category li{cursor:pointer;height:30px;overflow:hidden}.xnr_op li:hover{background:#ffffcc;color:black}.xnr_op li:nth-child(2n){background:#EEEEEE}.xnr_op li.selected{background:#748AC4;color:white}.xnr_op .category span{left:10px;position:relative;font-size:14px;line-height:30px}.xnr_op .pages>div{overflow:auto;height:280px;padding:10px}.xnr_op .pages>div>*{margin-bottom:5px;width:100%}.xnr_op table.group{margin-left:5px;margin-top:3px}.xnr_op .pages tr{line-height:20px}.xnr_op input[type="checkbox"]{margin-right:4px}.xnr_op label{color:black;font-weight:normal;cursor:pointer}.xnr_op label[for=""]{cursor:default}.xnr_op input[type="image"]{margin-left:2px;margin-right:2px}.xnr_op textarea{resize:none}.xnr_op .pages .default{text-align:center}.xnr_op .pages .default table{height:95%}.xnr_op .pages .default td{vertical-align:middle}.xnr_op .pages .default td>*{padding:5px}</style>';menuHTML+='<table><tbody><tr><td class="border tl"></td><td class="border m"></td><td class="border tr"></td></tr><tr><td class="border"></td><td class="c m"><div class="title">改造选项</div><div class="options"><table><tbody><tr><td class="category"><ul>'+categoryHTML+'</ul></td><td class="pages"><div class="default"><table><tbody><tr><td><h1>人人网改造器</h1><p><b>'+XNR.version+" ("+XNR.miniver+')</b></p><p><b>Copyright © 2008-2010</b></p><p><a href="mailto:xnreformer@gmail.com">xnreformer@gmail.com</a></p><p><a href="http://xiaonei-reformer.googlecode.com/" target="_blank">项目主页</a></p></td></tr></tbody></table></div></td></tr></tbody></table></div><div class="btns"><input type="button" value="确定" class="ok"/><input type="button" value="取消" class="cancel"/></div></td><td class="border"></td></tr><tr><td class="border bl"></td><td class="border m"></td><td class="border br"></td></tr></tbody></table>';var menu=$node("div").attr("class","xnr_op").style("display","none").code(menuHTML).appendTo(document.documentElement);menu.find("td.pages").append($(categoryPages));menu.find(".category ul").hook("click",function(evt){var t=$(evt.target);if(t.prop("tagName")=="SPAN"){t=t.superior()}menu.find(".pages>div").hide();menu.find(".pages>div").pick(t.index()+1).show();menu.find(".category li.selected").removeClass("selected");t.addClass("selected")});menu.find(".cancel").hook("click",function(evt){menu.hide();for(var op in XNR.options){if(typeof XNR.options[op]=="object"){var group=XNR.options[op];for(var item in group){var c=menu.find("#"+item);if(c.empty()){continue}else{c.value(group[item])}}}else{var c=menu.find("#"+op);if(c.empty()){continue}else{c.value(XNR.options[op])}if(c.attr("master")){$master(c)}}}});menu.find(".ok").hook("click",function(evt){var pass=true;menu.find("*[verify]:not([disabled])").each(function(elem){var node=$(elem);var rules=JSON.parse(node.attr("verify"));for(var rule in rules){if(!node.value().match(new RegExp(rule))){var page=node;while(page.superior().prop("className")!="pages"){page=page.superior()}var index=page.index();menu.find(".pages>div").hide().pick(index).show();menu.find(".category li").removeClass("selected").pick(index-1).addClass("selected");alert(rules[rule]);elem.focus();pass=false;return false}}});if(!pass){return}for(var op in XNR.options){if(typeof XNR.options[op]=="object"){var group=XNR.options[op];var changed=false;for(var item in group){var c=menu.find("#"+op+"_"+item);if(c.empty()){continue}else{var newValue=c.value();if(group[item]!=newValue){changed=true;group[item]=newValue}}}if(changed){$save(op,group)}}else{var c=menu.find("#"+op);if(c.empty()){continue}else{var newValue=c.value();if(XNR.options[op]!=newValue){$save(op,newValue)}}}}window.location.reload()});menu.find("div.title").hook("mousedown",function(evt){if(evt.button!=0){return}window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP);var move=$alloc("drag_optionMenu");var menuRect=menu.get().getBoundingClientRect();move.x=evt.clientX-menuRect.left;move.y=evt.clientY-menuRect.top;evt.target.style.cursor="move"}).hook("mouseup",function(evt){if($allocated("drag_optionMenu")){$dealloc("drag_optionMenu");window.releaseEvents(Event.MOUSEMOVE|Event.MOUSEUP);evt.target.style.cursor=null}});$(document.documentElement).hook("mousemove",function(evt){if($allocated("drag_optionMenu")){var move=$alloc("drag_optionMenu");menu.style({left:(evt.clientX-move.x)+"px",top:(evt.clientY-move.y)+"px"})}});var entry=$node("div").attr("class","menu").append($node("div").attr("class","menu-title").append($node("a").attr({href:"#nogo",onclick:"return false"}).text("改造")));entry.find("a").hook("click",function(){menu.show().style({top:parseInt(window.innerHeight-menu.prop("offsetHeight"))/2+"px",left:parseInt(window.innerWidth-menu.prop("offsetWidth"))/2+"px"})});$wait(1,function(){entry.prependTo($(".nav-body .nav-other"));for(var p=1;p<3;p++){for(var i=0;i<fnQueue[p].length;i++){var fn=fnQueue[p][i];if(fn.trigger){for(var t in fn.trigger){$(t).hook(fn.trigger[t],function(evt){try{fn.name(evt,fn.args[0],fn.args[1],fn.args[2],fn.args[3])}catch(err){$error(fn.name,err)}})}}else{try{fn.name(fn.args[0],fn.args[1],fn.args[2],fn.args[3])}catch(err){$error(fn.name,err)}}}}});$wait(3,function(){for(var i=0;i<fnQueue[3].length;i++){var fn=fnQueue[3][i];if(fn.trigger){for(var t in fn.trigger){$(t).hook(fn.trigger[t],function(evt){try{fn.name(evt,fn.args[0],fn.args[1],fn.args[2],fn.args[3])}catch(err){$error(fn.name,err)}})}}else{try{fn.name(fn.args[0],fn.args[1],fn.args[2],fn.args[3])}catch(err){$error(fn.name,err)}}}})}function $cookie(name,def){var cookies=document.cookie.split(";");name=escape(name);for(var i=0;i<cookies.length;i++){var c=cookies[i].replace(/^ +/g,"");if(c.indexOf(name+"=")==0){return unescape(c.substring(name.length+1,c.length))}}return def||""}function $node(name){if(!name){return PageKit(document.createTextNode(""))}else{return PageKit(document.createElement(name))}}function $page(category,url){const pages={home:"/[hH]ome\\.do",profile:"/[Pp]rofile\\.do|renren\\.com/$|/renren\\.com/\\?|/www\\.renren\\.com/\\?|/[a-zA-Z0-9_]{5,}\\.renren.com/\\?id=",blog:"/blog\\.renren\\.com/",club:"/club\\.renren\\.com/",};if(!url){url=window.location.href}if(url.contains("#")){url=url.replace(/#[\s\S]*$/,"")}return pages[category]==null||url.match(pages[category])!=null}function $alloc(name){if(!name){do{name="r"+Math.random()}while(!XNR.storage[name])}if(XNR.storage[name]){return XNR.storage[name]}else{XNR.storage[name]=new Object();return XNR.storage[name]}}function $allocated(name){return XNR.storage[name]!=null}function $dealloc(name){XNR.storage[name]=null}function $popup(title,content,geometry,stayTime,popSpeed){const timeout=50;var node=$node("div").style({position:"fixed",backgroundColor:"#F0F5F8",border:"1px solid #B8D4E8",zIndex:100000,overflow:"hidden"});var geo=/^(\d+)x\d+([+-]?)(\d*)([+-]?)(\d*)$/.exec(geometry);if(!geo){geo=["","200","+","5","-","5"]}node.style("width",(geo[1]=="0"?"auto":geo[1]+"px")).style((geo[2]||"+")=="+"?"left":"right",(geo[3]||"0")+"px").style((geo[4]||"-")=="+"?"top":"bottom",(geo[5]||"0")+"px");var closeLink=$node("a").style({cssFloat:"right",fontSize:"x-small",color:"white",cursor:"pointer"}).text("关闭").hook("click",function(){node.remove()});node.append($node("div").text((title||"提示")).append(closeLink).style({background:"#526EA6",color:"white",fontWeight:"bold",fontSize:"normal",padding:"3px"}));node.append($node("div").style("margin","5px").code(content)).appendTo(document.body);var maxHeight=parseInt(node.prop("clientHeight"));node.style("height","0px");setTimeout(function(){try{var h=parseInt(node.style("height"));if(h<maxHeight){var diff=maxHeight-h;node.style("height",(h+(diff>popSpeed?popSpeed:diff))+"px");setTimeout(arguments.callee,timeout)}else{setTimeout(function(){try{var h=parseInt(node.style("height"));if(h<=0){node.remove()}else{node.style("height",(h>popSpeed?h-popSpeed:0)+"px");setTimeout(arguments.callee,timeout)}}catch(err){}},stayTime*1000);closeLink.text("关闭("+stayTime+")");var timer=setInterval(function(){if(!node||stayTime<=0){clearInterval(timer)}else{stayTime--;closeLink.text("关闭("+stayTime+")")}},1000)}}catch(err){}},timeout);return node}function $wait(stage,func){var curStage=2;if(document.readyState=="loading"){curStage=0}else{if(document.readyState=="completed"){curStage=3}else{if(stage==1||stage==2){curStage=stage}}}if(stage>curStage){if(stage<3){document.addEventListener("DOMContentLoaded",func,false)}else{if(stage==3){document.addEventListener("load",func,false)}}}else{func()}}function $patchCSS(style){return $node("style").attr("type","text/css").text(style).appendTo(document.documentElement)}function $ban(style){$patchCSS(style+"{display:none !important}");$wait(1,function(){$(style).remove()})}function $save(name,value){XNR.options[name]=value;var opts=JSON.stringify(XNR.options);switch(XNR.agent){case USERSCRIPT:GM_setValue("xnr_options",opts);break;case FIREFOX:Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefService).setCharPref("extensions.xiaonei_reformer.xnr_options",escape(opts));break;case CHROME:chrome.extension.sendRequest({action:"save",data:opts});break}}function $get(url,func,userData){switch(XNR.agent){case FIREFOX:var httpReq=new XMLHttpRequest();if(func!=null){httpReq.onload=function(){func((httpReq.status==200?httpReq.responseText:null),url,userData)};httpReq.onerror=function(){func(null,url,userData)}}httpReq.open("GET",url,true);httpReq.send();break;case USERSCRIPT:if(func!=null){GM_xmlhttpRequest({method:"GET",url:url,onload:function(o){func((o.status==200?o.responseText:null),url,userData)},onerror:function(o){func(null,url,userData)}})}else{GM_xmlhttpRequest({method:"GET",url:url})}break;case CHROME:chrome.extension.sendRequest({action:"get",url:url},func==null?null:function(response){func(response.data,url,userData)});break}}function $error(func,error){if(typeof func=="function"){func=func.getName()}if(typeof error=="object"&&error.name&&error.message){var msg="在 "+func+"() 中发生了一个错误。\n错误名称："+error.name+"\n错误信息："+error.message;if(XNR.agent!=USERSCRIPT){msg="人人网改造器："+msg}if(XNR.agent==FIREFOX){Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService).logStringMessage(msg)}else{console.log(msg)}}}function $master(master){var p=master.superior();if(!master.value()){p.find("*:not([id='"+master.attr("id")+"'])").prop("disabled",true);p.find("input[type='image']").prop("disabled",false)}else{p.find("*").prop("disabled",false)}}function PageKit(o){if(!(this instanceof PageKit)){return o?new PageKit(arguments):null}return this.init(o)}PageKit.prototype={init:function(o){this.nodes=[];for(var i=0;i<o.length;i++){var selector=o[i];if(typeof selector=="string"){this.nodes=this.nodes.concat(Array.prototype.slice.call(document.querySelectorAll(selector)))}else{if(selector.nodeType){this.nodes=this.nodes.concat(Array(selector))}else{if(selector instanceof PageKit){this.nodes=this.nodes.concat(o.nodes)}else{this.nodes=this.nodes.concat(Array.prototype.slice.call(selector))}}}}return this},each:function(func){if(typeof func=="function"){for(var i=0;i<this.nodes.length;i++){try{if(!(func(this.nodes[i],i)==null)){break}}catch(err){}}}return this},get:function(index){try{if(index==null){index=0}else{if(index==-1){index=this.nodes.length-1}}return this.nodes[index]}catch(err){return null}},pick:function(index){return PageKit(this.get(index))},remove:function(safe){this.each(function(elem){if(!safe||elem.childElementCount==0){elem.parentNode.removeChild(elem)}});this.nodes=[];return this},purge:function(safe){this.each(function(elem){if(!safe||elem.childElementCount==0){var p=elem.parentNode;p.removeChild(elem);while(p.childElementCount==0){var q=p.parentNode;q.removeChild(p);p=q}}});this.nodes=[];return this},hide:function(){this.each(function(elem){elem.style.display="none"});return this},show:function(){this.each(function(elem){elem.style.display=null;elem.style.visibility=null});return this},switchTo:function(o){if(typeof o=="string"){o=document.createElement(o)}else{if(o instanceof PageKit){o=o.get()}}if(o.nodeType){var xnr=this;this.each(function(elem,index){var newNode=o.cloneNode(false);while(elem.childNodes.length>0){newNode.appendChild(elem.childNodes[0])}elem.parentNode.replaceChild(newNode,elem);xnr.nodes[index]=newNode})}return this},size:function(){return this.nodes.length},empty:function(){return this.nodes.length==0},heirs:function(index){try{return this.get(index).childElementCount}catch(err){return 0}},index:function(){try{var node=this.get().previousElementSibling;var c=0;for(;node!=null;node=node.previousElementSibling){c++}return c}catch(err){return 0}},child:function(index){try{var node=this.get();return $(node.children[index!=-1?index:node.childElementCount-1])}catch(err){return null}},superior:function(){try{return PageKit(this.get().parentNode)}catch(err){return null}},previous:function(){try{return PageKit(this.get().previousElementSibling)}catch(err){return null}},next:function(){try{return PageKit(this.get().nextElementSibling)}catch(err){return null}},append:function(o){var node=this.get();if(!node){return this}else{if(node.nodeType==1){if(o instanceof PageKit){o.each(function(elem){node.appendChild(elem)})}else{if(o.nodeType==1){node.appendChild(o)}else{if(typeof o=="string"){node.innerHTML+=o}}}}}return this},insert:function(o,pos){var node=this.get();var xhr=this;if(!node){return this}else{if(node.nodeType==1){if(pos<0){pos=0}else{if(pos>node.childElementCount){pos=node.childElementCount}}if(o instanceof PageKit){o.each(function(elem){xhr.insert(elem,pos);pos++})}else{if(o.nodeType==1){if(pos==node.childElementCount){node.appendChild(o)}else{node.insertBefore(o,node.children[pos])}}else{if(typeof o=="string"){xhr.insert($($node("div",o).get().children),pos)}}}}}return this},prepend:function(o){var node=this.get();if(!node){return this}else{if(node.nodeType==1){if(node.firstElementChild){if(o instanceof PageKit){var insertPlace=node.firstElementChild;o.each(function(elem){node.insertBefore(elem,insertPlace)})}else{if(o.nodeType==1){node.insertBefore(o,node.firstElementChild)}else{if(typeof o=="string"){node.innerHTML=o+node.innerHTML}}}}else{this.append(o)}}}return this},appendTo:function(o){if(o instanceof PageKit){o.append(this)}else{if(o.nodeType==1){PageKit(o).append(this)}}return this},insertTo:function(o,pos){if(o instanceof PageKit){o.insert(this,pos)}else{if(o.nodeType==1){PageKit(o).insert(this,pos)}}return this},prependTo:function(o){if(o instanceof PageKit){o.prepend(this)}else{if(o.nodeType==1){PageKit(o).prepend(this)}}return this},find:function(str){var res=new Array();this.each(function(elem){res=res.concat(Array.prototype.slice.call(elem.querySelectorAll(str)))});return PageKit(res)},filter:function(o){if(!o){return this}var res=new Array();if(typeof o=="string"){this.each(function(elem){if(elem.querySelector(o)){res.push(elem)}})}else{if(typeof o=="function"){this.each(function(elem){if(o(elem)){res.push(elem)}})}}this.nodes=res;return this},attr:function(o,v){switch(typeof o){case"object":for(var n in o){this.each(function(elem){if(o[n]!=null){elem.setAttribute(n,o[n])}else{elem.removeAttribute(n)}})}return this;case"string":if(v!=null){this.each(function(elem){elem.setAttribute(o,v)});return this}else{try{return this.get().getAttribute(o)}catch(err){return null}}}return this},prop:function(o,v){switch(typeof o){case"object":for(var n in o){this.each(function(elem){elem[n]=o[n]})}return this;case"string":if(v!=null){this.each(function(elem){elem[o]=v});return this}else{try{return this.get()[o]}catch(err){return null}}}return this},style:function(o,v){switch(typeof o){case"object":for(var n in o){this.each(function(elem){elem.style[n]=o[n]})}return this;case"string":if(v!=null){this.each(function(elem){elem.style[o]=v});return this}else{try{return this.get().style[o]}catch(err){return null}}}return this},addClass:function(str){this.each(function(elem){var xnr=$(elem);var c=xnr.attr("class");if(!c){xnr.attr("class",str)}else{if(!c.match(new RegExp("\\b"+str+"\\b"))){xnr.attr("class",c+" "+str)}}});return this},removeClass:function(str){this.each(function(elem){var xnr=$(elem);var c=xnr.attr("class");if(c&&c.match(new RegExp("\\b"+str+"\\b"))){xnr.attr("class",c.replace(new RegExp("\\b"+str+"\\b"),"").replace(/^ +| +$/g,""))}});return this},text:function(txt){if(txt!=null){this.each(function(elem){elem.textContent=txt});return this}else{var elem=this.get();if(elem==null){return""}else{return elem.textContent||""}}},code:function(html){if(html!=null){this.each(function(elem){elem.innerHTML=html});return this}else{var elem=this.get();if(elem==null){return""}else{return elem.innerHTML||""}}},value:function(v){if(v!=null){this.each(function(elem){switch(elem.tagName){case"INPUT":switch(($(elem).attr("type")||"").toLowerCase()){case"checkbox":elem.checked=v;break;default:elem.value=v;break}break;case"TEXTAREA":elem.value=v;break;default:$(elem).text(v);break}})}else{var elem=this.get();switch(elem.tagName){case"INPUT":switch(($(elem).attr("type")||"").toLowerCase()){case"checkbox":return elem.checked;default:return elem.value}case"TEXTAREA":return elem.value;default:return $(elem).text()}}},hook:function(evt,func){var e=evt.split(",");this.each(function(elem){for(var i=0;i<e.length;i++){elem.addEventListener(e[i],func,false)}});return this},invoke:function(evt){this.each(function(elem){try{var e=elem.getAttribute(evt);if(!e){return}if(e.toLowerCase().indexOf("javascript:")!=0){e="javascript:"+e}window.location.href=e}catch(err){$error("invoke",err)}});return this},clone:function(evt){var nodes=[];this.each(function(elem){nodes.push(elem.cloneNode(true))});return PageKit(nodes)}};switch(XNR.agent){case USERSCRIPT:main(JSON.parse(GM_getValue("xnr_options","{}")));break;case CHROME:chrome.extension.sendRequest({action:"load"},function(response){main(response.options)});break;case FIREFOX:try{main(JSON.parse(unescape(Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefService).getCharPref("extensions.xiaonei_reformer.xnr_options"))))}catch(err){main({})}break;default:throw"unsupported browser"}})(typeof docWindow=="undefined"?window:docWindow);}

var myListener={
	onLocationChange: function(aBrowser, aProgress, aRequest, aURI) {
		if(aBrowser.contentDocument.readyState=="loading") {
			loader(aBrowser.contentWindow,true);
		}
	},
	onProgressChange: function(aBrowser, aWebProgress, aRequest, curSelf, maxSelf, curTot, maxTot) {},
	onStateChange: function(aBrowser, aWebProgress, aRequest, aFlag, aStatus) {},  
	onStatusChange: function(aBrowser, aWebProgress, aRequest, aStatus, aMessage) {},
	onSecurityChange: function(aBrowser, aWebProgress, aRequest, aState) {},
	onRefreshAttempted: function(aBrowser, aWebProgress, aRefreshURI, aMillis,aSameURI) {},
	onLinkIconAvailable: function(aBrowser) {}
};

window.addEventListener("load",function() {
	gBrowser.addTabsProgressListener(myListener);
	gBrowser.addEventListener("DOMContentLoaded",loader,true);
},false);

window.addEventListener("unload",function() {
	gBrowser.removeEventListener("DOMContentLoaded",loader,true);
	gBrowser.removeTabsProgressListener(myListener);
},false);

