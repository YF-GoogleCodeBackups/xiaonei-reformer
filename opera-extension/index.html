<doctype html>
<html>
  <head>
    <title>xnr background</title>
	<script type="text/javascript">
		opera.extension.onmessage=function(event) {
			var request=JSON.parse(event.data);
			switch(request.action) {
				case "save":
					localStorage.setItem("xnr_options",request.data);
					break;
				case "load":
					var options=localStorage.getItem("xnr_options");
					if(!options) {
						options={};
					}
					event.source.postMessage(JSON.stringify({reqId:request.reqId,data:options})); 
					break;
				case "get":
					var httpReq= new XMLHttpRequest();
					httpReq.onload=function() {
						event.source.postMessage(JSON.stringify({reqId:request.reqId,data:(httpReq.status==200?httpReq.responseText:null)}));
					};
					httpReq.onerror=function(e) {
						event.source.postMessage(JSON.stringify({reqId:request.reqId,data:null}));
					};
					httpReq.open(request.method,request.url,true);
					httpReq.send();
					break;
				case "album":
					//chrome.tabs.create({url:chrome.extension.getURL("album.html")+"#"+encodeURIComponent(JSON.stringify(request.data))});
					break;
			}
		};
	</script>
  </head>
</html>
