<html>
<head>
<title>XNR Background</title>
<script>
chrome.extension.onRequest.addListener(
function(request, sender, sendResponse) {
	switch(request.action) {
		case "set":
			var options=localStorage.getItem("xnr_options");
			if(options==null || JSON.stringify(options)=="\"undefined\"") {
				options={};
			} else {
				options=JSON.parse(options);
			}
			options[request.name]=request.data;
			localStorage.setItem("xnr_options",JSON.stringify(options));
			break;
		case "get":
			var options=localStorage.getItem("xnr_options");
			if(options==null || JSON.stringify(options)=="\"undefined\"") {
				options={};
			} else {
				options=JSON.parse(options);
			}
			sendResponse({data:options});
			break;
		case "httpGet":
			var httpReq= new XMLHttpRequest();
			httpReq.onreadystatechange=function() {
				if(httpReq.readyState==4 && httpReq.status==200) {
					sendResponse({data:httpReq.responseText});
				}
			};
		    httpReq.open("GET",request.url,true);
			//httpReq.setRequestHeader("Cache-Control","no-cache");
			httpReq.send();
			break;
		case "dlAlbum":
			chrome.tabs.create({url:chrome.extension.getURL("dlAlbum.html")+"?d='"+request.data+"'&t='"+request.title+"'"});
			break;
	}
});
</script>
</head>
<body>
</body>
</html>
